<?xml version="1.0"?>
  <database name="VIEW ETESO_EXPIRED_SALES_ORDER_V">
    <view name="ETESO_EXPIRED_SALES_ORDER_V"><![CDATA[SELECT o.c_order_id AS eteso_expired_sales_order_v_id, o.ad_client_id, o.ad_org_id, o.isactive, o.created, o.createdby, o.updated, o.updatedby, o.documentno, o.dateordered, o.datepromised, bp.name AS business_partner, o.grandtotal, COALESCE(sum(il.linenetamt), 0) AS invoiced_amount FROM c_order o JOIN c_bpartner bp ON bp.c_bpartner_id = o.c_bpartner_id JOIN c_orderline ol ON ol.c_order_id = o.c_order_id LEFT JOIN c_invoiceline il ON il.c_orderline_id = ol.c_orderline_id WHERE o.issotrx = 'Y' AND o.datepromised < now() GROUP BY o.c_order_id, o.ad_client_id, o.ad_org_id, o.isactive, o.created, o.createdby, o.updated, o.updatedby, o.documentno, o.dateordered, o.datepromised, bp.name, o.grandtotal HAVING (EXISTS (SELECT 1 FROM c_orderline ol2 LEFT JOIN c_invoiceline il2 ON il2.c_orderline_id = ol2.c_orderline_id WHERE ol2.c_order_id = o.c_order_id GROUP BY ol2.c_orderline_id, ol2.linenetamt HAVING COALESCE(sum(il2.linenetamt), 0) < ol2.linenetamt))]]></view>
  </database>
